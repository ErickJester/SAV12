<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes y Análisis - SAV12</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --dark: #1e293b;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .main-container {
            margin-top: 80px;
            padding-bottom: 50px;
        }

        /* KPI Cards */
        .kpi-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: none;
            transition: all 0.3s ease;
            height: 100%;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .kpi-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 8px 0;
            line-height: 1;
        }

        .kpi-label {
            color: #64748b;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Dashboard Cards */
        .dashboard-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            border: none;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Alerts Panel */
        .alert-item {
            background: #fef2f2;
            border-left: 4px solid var(--danger);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .alert-item.warning {
            background: #fffbeb;
            border-left-color: var(--warning);
        }

        .alert-item.info {
            background: #eff6ff;
            border-left-color: var(--info);
        }

        /* Tables */
        .custom-table {
            margin-bottom: 0;
        }

        .custom-table thead {
            background: #f8fafc;
        }

        .custom-table th {
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e2e8f0;
            padding: 12px;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .custom-table td {
            padding: 12px;
            vertical-align: middle;
        }

        /* Progress Bars */
        .progress-custom {
            height: 8px;
            border-radius: 10px;
            background: #e2e8f0;
        }

        .progress-bar-custom {
            border-radius: 10px;
            transition: width 0.6s ease;
        }

        /* Badges */
        .badge-custom {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.75rem;
        }

        /* Period Selector */
        .period-selector {
            background: white;
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 24px;
        }

        .btn-period {
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-period.active {
            background: var(--primary);
            color: white;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Color Utilities */
        .bg-primary-soft { background: #dbeafe; color: var(--primary); }
        .bg-success-soft { background: #d1fae5; color: var(--success); }
        .bg-warning-soft { background: #fef3c7; color: var(--warning); }
        .bg-danger-soft { background: #fee2e2; color: var(--danger); }
        .bg-info-soft { background: #cffafe; color: var(--info); }

        /* Responsive */
        @media (max-width: 768px) {
            .kpi-value { font-size: 2rem; }
            .chart-container { height: 250px; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold text-primary" href="/admin/panel">
            <i class="bi bi-graph-up-arrow"></i> SAV12 Admin
        </a>
        <div class="ms-auto d-flex align-items-center gap-3">
            <span class="text-muted">
                <i class="bi bi-person-circle"></i>
                <span th:text="${usuario.nombre}">Usuario</span>
            </span>
            <a href="/logout" class="btn btn-outline-danger btn-sm">
                <i class="bi bi-box-arrow-right"></i> Salir
            </a>
        </div>
    </div>
</nav>

<div class="container-fluid main-container">
    
    <!-- Period Selector -->
    <div class="period-selector">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-period" 
                            th:classappend="${periodoSeleccionado == 'semanal' ? 'active' : 'btn-outline-primary'}"
                            onclick="cambiarPeriodo('semanal')">
                        Última Semana
                    </button>
                    <button type="button" class="btn btn-period"
                            th:classappend="${periodoSeleccionado == 'mensual' ? 'active' : 'btn-outline-primary'}"
                            onclick="cambiarPeriodo('mensual')">
                        Último Mes
                    </button>
                    <button type="button" class="btn btn-period"
                            th:classappend="${periodoSeleccionado == 'trimestral' ? 'active' : 'btn-outline-primary'}"
                            onclick="cambiarPeriodo('trimestral')">
                        Último Trimestre
                    </button>
                    <button type="button" class="btn btn-period"
                            th:classappend="${periodoSeleccionado == 'anual' ? 'active' : 'btn-outline-primary'}"
                            onclick="cambiarPeriodo('anual')">
                        Último Año
                    </button>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-success" onclick="exportarReporte('pdf')">
                        <i class="bi bi-file-pdf"></i> Exportar PDF
                    </button>
                    <button type="button" class="btn btn-outline-success" onclick="exportarReporte('csv')">
                        <i class="bi bi-file-spreadsheet"></i> Exportar CSV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- KPIs Ejecutivos -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="kpi-card">
                <div class="kpi-icon bg-primary-soft">
                    <i class="bi bi-ticket-perforated"></i>
                </div>
                <div class="kpi-value" th:text="${kpis.totalTickets}">0</div>
                <div class="kpi-label">Total Tickets</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="kpi-card">
                <div class="kpi-icon bg-success-soft">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div class="kpi-value" th:text="${kpis.ticketsResueltos}">0</div>
                <div class="kpi-label">Resueltos</div>
                <small class="text-muted">
                    <span th:text="${kpis.tasaResolucion}">0</span>% tasa resolución
                </small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="kpi-card">
                <div class="kpi-icon bg-warning-soft">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="kpi-value" th:text="${kpis.ticketsPendientes}">0</div>
                <div class="kpi-label">Pendientes</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="kpi-card">
                <div class="kpi-icon bg-danger-soft">
                    <i class="bi bi-exclamation-triangle"></i>
                </div>
                <div class="kpi-value" th:text="${kpis.ticketsCriticos}">0</div>
                <div class="kpi-label">Críticos Pendientes</div>
            </div>
        </div>
    </div>

    <!-- Alertas -->
    <div class="dashboard-card" th:if="${alertas.tieneAlertas}">
        <div class="card-title">
            <i class="bi bi-bell text-danger"></i> Alertas Importantes
        </div>
        <div class="row">
            <div class="col-md-6" th:if="${alertas.ticketsSinAsignar > 0}">
                <div class="alert-item warning">
                    <strong><i class="bi bi-inbox"></i> Tickets sin asignar:</strong>
                    <span th:text="${alertas.ticketsSinAsignar}">0</span> tickets esperando asignación
                </div>
            </div>
            <div class="col-md-6" th:if="${alertas.ticketsVencidos > 0}">
                <div class="alert-item">
                    <strong><i class="bi bi-clock"></i> Tickets vencidos:</strong>
                    <span th:text="${alertas.ticketsVencidos}">0</span> tickets fuera de SLA
                </div>
            </div>
            <div class="col-md-6" th:if="${alertas.ticketsCriticosPendientes > 0}">
                <div class="alert-item">
                    <strong><i class="bi bi-exclamation-triangle"></i> Críticos pendientes:</strong>
                    <span th:text="${alertas.ticketsCriticosPendientes}">0</span> tickets de alta prioridad
                </div>
            </div>
            <div class="col-md-6" th:if="${alertas.tecnicosSobrecargados > 0}">
                <div class="alert-item info">
                    <strong><i class="bi bi-people"></i> Técnicos sobrecargados:</strong>
                    <span th:text="${alertas.tecnicosSobrecargados}">0</span> técnicos con +10 tickets
                </div>
            </div>
        </div>
    </div>

    <!-- Row 1: SLA + Tiempos -->
    <div class="row">
        <!-- Cumplimiento SLA -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <div class="card-title">
                    <i class="bi bi-speedometer2 text-primary"></i> Cumplimiento de SLA
                </div>
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-semibold">Primera Respuesta</span>
                        <span class="fw-bold text-primary">
                            <span th:text="${reporteSLA.slaPrimeraRespuestaPorcentaje}">0</span>%
                        </span>
                    </div>
                    <div class="progress progress-custom">
                        <div class="progress-bar bg-primary progress-bar-custom" 
                             th:style="'width: ' + ${reporteSLA.slaPrimeraRespuestaPorcentaje} + '%'">
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <small class="text-success">
                            <i class="bi bi-check-circle"></i> 
                            <span th:text="${reporteSLA.ticketsCumplenPrimeraRespuesta}">0</span> cumplen
                        </small>
                        <small class="text-danger">
                            <i class="bi bi-x-circle"></i> 
                            <span th:text="${reporteSLA.ticketsIncumplenPrimeraRespuesta}">0</span> incumplen
                        </small>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-semibold">Resolución</span>
                        <span class="fw-bold text-success">
                            <span th:text="${reporteSLA.slaResolucionPorcentaje}">0</span>%
                        </span>
                    </div>
                    <div class="progress progress-custom">
                        <div class="progress-bar bg-success progress-bar-custom" 
                             th:style="'width: ' + ${reporteSLA.slaResolucionPorcentaje} + '%'">
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <small class="text-success">
                            <i class="bi bi-check-circle"></i> 
                            <span th:text="${reporteSLA.ticketsCumplenResolucion}">0</span> cumplen
                        </small>
                        <small class="text-danger">
                            <i class="bi bi-x-circle"></i> 
                            <span th:text="${reporteSLA.ticketsIncumplenResolucion}">0</span> incumplen
                        </small>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="slaChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Análisis de Tiempos -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <div class="card-title">
                    <i class="bi bi-stopwatch text-info"></i> Análisis de Tiempos Promedio
                </div>
                <div class="chart-container">
                    <canvas id="tiemposChart"></canvas>
                </div>
                <div class="mt-3">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="fw-bold text-primary" style="font-size: 1.5rem;">
                                <span th:text="${analisisTiempos.tiempoPromedioRespuestaMin}">0</span>
                            </div>
                            <small class="text-muted">Min. Primera Respuesta</small>
                        </div>
                        <div class="col-4">
                            <div class="fw-bold text-success" style="font-size: 1.5rem;">
                                <span th:text="${analisisTiempos.tiempoPromedioResolucionMin}">0</span>
                            </div>
                            <small class="text-muted">Min. Resolución</small>
                        </div>
                        <div class="col-4">
                            <div class="fw-bold text-warning" style="font-size: 1.5rem;">
                                <span th:text="${analisisTiempos.tiempoPromedioEsperaMin}">0</span>
                            </div>
                            <small class="text-muted">Min. En Espera</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Row 2: Desempeño Técnicos -->
    <div class="dashboard-card">
        <div class="card-title">
            <i class="bi bi-people text-success"></i> Desempeño de Técnicos
        </div>
        <div class="table-responsive">
            <table class="table custom-table">
                <thead>
                    <tr>
                        <th>Técnico</th>
                        <th class="text-center">Total</th>
                        <th class="text-center">Resueltos</th>
                        <th class="text-center">En Proceso</th>
                        <th class="text-center">Reabiertos</th>
                        <th class="text-center">Tasa Éxito</th>
                        <th class="text-center">SLA</th>
                        <th class="text-center">Tiempo Prom.</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="tecnico : ${desempenoTecnicos}">
                        <td>
                            <i class="bi bi-person-badge text-primary"></i>
                            <span class="fw-semibold" th:text="${tecnico.tecnico}">Técnico</span>
                        </td>
                        <td class="text-center">
                            <span class="badge badge-custom bg-primary-soft" th:text="${tecnico.totalAsignados}">0</span>
                        </td>
                        <td class="text-center">
                            <span class="badge badge-custom bg-success-soft" th:text="${tecnico.resueltos}">0</span>
                        </td>
                        <td class="text-center">
                            <span class="badge badge-custom bg-warning-soft" th:text="${tecnico.enProceso}">0</span>
                        </td>
                        <td class="text-center">
                            <span class="badge badge-custom bg-danger-soft" th:text="${tecnico.reabiertos}">0</span>
                        </td>
                        <td class="text-center">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="progress progress-custom" style="width: 60px; margin-right: 8px;">
                                    <div class="progress-bar bg-success progress-bar-custom" 
                                         th:style="'width: ' + ${tecnico.tasaExito} + '%'"></div>
                                </div>
                                <span class="fw-semibold" th:text="${tecnico.tasaExito} + '%'">0%</span>
                            </div>
                        </td>
                        <td class="text-center">
                            <span class="fw-semibold" 
                                  th:classappend="${tecnico.cumplimientoSLA >= 80} ? 'text-success' : 'text-danger'"
                                  th:text="${tecnico.cumplimientoSLA} + '%'">0%</span>
                        </td>
                        <td class="text-center">
                            <span th:text="${tecnico.tiempoPromedioResolucionMin} + ' min'">0 min</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Row 3: Prioridades + Ubicaciones -->
    <div class="row">
        <!-- Análisis por Prioridad -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <div class="card-title">
                    <i class="bi bi-flag text-danger"></i> Análisis por Prioridad
                </div>
                <div class="chart-container">
                    <canvas id="prioridadChart"></canvas>
                </div>
                <div class="mt-3">
                    <div th:each="prio : ${analisisPorPrioridad}" class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="fw-semibold">
                                <i class="bi bi-flag-fill" 
                                   th:classappend="${prio.prioridad == 'ALTA'} ? 'text-danger' : (${prio.prioridad == 'MEDIA'} ? 'text-warning' : 'text-info')"></i>
                                <span th:text="${prio.prioridad}">ALTA</span>
                            </span>
                            <span>
                                <span class="text-success fw-semibold" th:text="${prio.resueltos}">0</span>
                                <span class="text-muted">/</span>
                                <span th:text="${prio.total}">0</span>
                            </span>
                        </div>
                        <div class="progress progress-custom">
                            <div class="progress-bar bg-success progress-bar-custom" 
                                 th:style="'width: ' + ${prio.total > 0 ? (prio.resueltos * 100 / prio.total) : 0} + '%'">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Ubicaciones -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <div class="card-title">
                    <i class="bi bi-geo-alt text-warning"></i> Top 10 Ubicaciones
                </div>
                <div class="table-responsive">
                    <table class="table custom-table">
                        <thead>
                            <tr>
                                <th>Ubicación</th>
                                <th class="text-center">Total</th>
                                <th class="text-center">Resueltos</th>
                                <th class="text-center">Pendientes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="ubi : ${analisisPorUbicaciones}">
                                <td>
                                    <i class="bi bi-building text-warning"></i>
                                    <span th:text="${ubi.ubicacion}">Ubicación</span>
                                </td>
                                <td class="text-center">
                                    <span class="badge badge-custom bg-primary-soft" th:text="${ubi.total}">0</span>
                                </td>
                                <td class="text-center">
                                    <span class="badge badge-custom bg-success-soft" th:text="${ubi.resueltos}">0</span>
                                </td>
                                <td class="text-center">
                                    <span class="badge badge-custom bg-warning-soft" th:text="${ubi.pendientes}">0</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Row 4: Tickets Problemáticos -->
    <div class="dashboard-card">
        <div class="card-title">
            <i class="bi bi-exclamation-octagon text-danger"></i> Tickets Problemáticos
        </div>
        <div class="row">
            <!-- Más Reabiertos -->
            <div class="col-md-4">
                <h6 class="fw-semibold mb-3">
                    <i class="bi bi-arrow-repeat text-danger"></i> Más Reabiertos
                </h6>
                <div th:each="ticket : ${ticketsProblematicos.masReabiertos}" class="mb-3 p-2 bg-light rounded">
                    <div class="fw-semibold">
                        <a th:href="@{/admin/ticket/{id}(id=${ticket.id})}" th:text="'#' + ${ticket.id}">ID</a>
                    </div>
                    <small th:text="${ticket.titulo}">Título</small>
                    <div class="mt-1">
                        <span class="badge bg-danger" th:text="${ticket.reabiertos} + ' reaperturas'">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Mayor Tiempo Sin Resolver -->
            <div class="col-md-4">
                <h6 class="fw-semibold mb-3">
                    <i class="bi bi-hourglass-split text-warning"></i> Mayor Tiempo Sin Resolver
                </h6>
                <div th:each="ticket : ${ticketsProblematicos.mayorTiempo}" class="mb-3 p-2 bg-light rounded">
                    <div class="fw-semibold">
                        <a th:href="@{/admin/ticket/{id}(id=${ticket.id})}" th:text="'#' + ${ticket.id}">ID</a>
                    </div>
                    <small th:text="${ticket.titulo}">Título</small>
                    <div class="mt-1">
                        <span class="badge bg-warning" th:text="${ticket.tiempoMin} + ' min'">0 min</span>
                    </div>
                </div>
            </div>
            
            <!-- Sin Primera Respuesta -->
            <div class="col-md-4">
                <h6 class="fw-semibold mb-3">
                    <i class="bi bi-clock-history text-info"></i> Sin Primera Respuesta
                </h6>
                <div th:each="ticket : ${ticketsProblematicos.sinPrimeraRespuesta}" class="mb-3 p-2 bg-light rounded">
                    <div class="fw-semibold">
                        <a th:href="@{/admin/ticket/{id}(id=${ticket.id})}" th:text="'#' + ${ticket.id}">ID</a>
                    </div>
                    <small th:text="${ticket.titulo}">Título</small>
                    <div class="mt-1">
                        <span class="badge bg-info" th:text="${ticket.horasEspera} + ' hrs'">0 hrs</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    // Datos del servidor
    const reporteSLA = /*[[${reporteSLA}]]*/ {};
    const analisisTiempos = /*[[${analisisTiempos}]]*/ {};
    const analisisPorPrioridad = /*[[${analisisPorPrioridad}]]*/ [];

    // Gráfico de SLA
    const ctxSLA = document.getElementById('slaChart').getContext('2d');
    new Chart(ctxSLA, {
        type: 'doughnut',
        data: {
            labels: ['Cumplen SLA', 'Incumplen SLA'],
            datasets: [{
                data: [reporteSLA.ticketsCumplenResolucion, reporteSLA.ticketsIncumplenResolucion],
                backgroundColor: ['#10b981', '#ef4444'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Gráfico de Tiempos
    const ctxTiempos = document.getElementById('tiemposChart').getContext('2d');
    new Chart(ctxTiempos, {
        type: 'bar',
        data: {
            labels: ['Primera Respuesta', 'Resolución', 'En Espera'],
            datasets: [{
                label: 'Minutos',
                data: [
                    analisisTiempos.tiempoPromedioRespuestaMin,
                    analisisTiempos.tiempoPromedioResolucionMin,
                    analisisTiempos.tiempoPromedioEsperaMin
                ],
                backgroundColor: ['#2563eb', '#10b981', '#f59e0b'],
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Minutos'
                    }
                }
            }
        }
    });

    // Gráfico de Prioridad
    const ctxPrioridad = document.getElementById('prioridadChart').getContext('2d');
    const prioridadLabels = analisisPorPrioridad.map(p => p.prioridad);
    const prioridadData = analisisPorPrioridad.map(p => p.total);
    const prioridadColors = {
        'ALTA': '#ef4444',
        'MEDIA': '#f59e0b',
        'BAJA': '#06b6d4'
    };

    new Chart(ctxPrioridad, {
        type: 'pie',
        data: {
            labels: prioridadLabels,
            datasets: [{
                data: prioridadData,
                backgroundColor: prioridadLabels.map(label => prioridadColors[label]),
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Función para cambiar período
    function cambiarPeriodo(periodo) {
        window.location.href = '/admin/reportes?periodo=' + periodo;
    }

    // Función para exportar reportes
    function exportarReporte(formato) {
        const periodoBtn = document.querySelector('.btn-period.active');
        const periodoTexto = periodoBtn ? periodoBtn.textContent.trim() : 'Último Mes';
        
        const periodoParam = periodoTexto === 'Última Semana' ? 'semanal' :
                            periodoTexto === 'Último Mes' ? 'mensual' :
                            periodoTexto === 'Último Trimestre' ? 'trimestral' : 'anual';
        
        const url = `/admin/reportes/export/${formato}?periodo=${periodoParam}`;
        
        // Mostrar indicador de descarga
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Generando...';
        
        // Crear iframe invisible para descarga
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = url;
        document.body.appendChild(iframe);
        
        // Restaurar botón después de 2 segundos
        setTimeout(() => {
            btn.disabled = false;
            btn.innerHTML = originalHTML;
            document.body.removeChild(iframe);
        }, 2000);
    }
</script>

</body>
</html>
